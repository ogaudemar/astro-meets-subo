# i18n — Internationalization

## Supported Languages

| Code | Path   | Translation file                        | Status |
|------|--------|-----------------------------------------|--------|
| en   | `/`    | `src/content/translations/en.json`      | ✓ Default |
| fr   | `/fr`  | `src/content/translations/fr.json`      | ✓ Live |
| es   | `/es`  | `src/content/translations/es.json`      | ✓ Live |
| de   | `/de`  | `src/content/translations/de.json`      | ✓ Live |
| pt-br | `/pt-br` | `src/content/translations/pt-br.json` | ✓ Live |

Next candidates from `astro.config.mjs` comment: `it`, `nl`, `pl`

---

## File Structure Pattern

- Root-level pages (`src/pages/index.astro`, `src/pages/pricing.astro`) are the **English** versions.
- Translated pages live under `src/pages/{lang}/` (e.g. `src/pages/de/index.astro`).
- Each page imports its JSON and passes it as a `translations` prop to components.
- Components do **not** import translation files directly — the page does and passes it down.

---

## Translation Props Pattern

```astro
import translations from '../../content/translations/de.json';
// Pass full object or sub-key:
<Header translations={translations.header} />
<UseCases translations={translations} />
```

For client-side `<script>` blocks, use `define:vars` to inject values (makes the script inline — no imports allowed):

```astro
<script define:vars={{ items: translations.someList }}>
  // items is available as a plain JS variable
</script>
```

---

## Translation JSON Structure

All keys present in `en.json` must exist in every locale file. Top-level keys:

- `siteTitle`, `siteDescription`
- `header` — navItems, resources, cta, upgrade, skipToMain
- `footer` — brandDescription, brandStats, copyright, sections, socialDiscordLabel
- `hero` — title, rotatingWords[], subtitle, cta, ctaNote
- `features` — title, subtitle, list[] (3 items with title + content[])
- `usecasesTitle`, `usecasesSubtitle`, `usecasesInspireBtn`, `usecasesList` (46 items with emojis embedded as plain strings)
- `testimonialsTitle`, `testimonialsSubTitle`, `testimonialsList`
- `ctaTitle`, `ctaSubtitle`, `ctaButton`
- `successTitle`, `successMessage`, `successDescription`, `successNextSteps`, `successSteps`
- `faqTitle`, `faqList`
- `priceTable` — tiers[], tableData[], buttonRow[]
- `surveyConvos` — all sub-keys
- `about` — all sub-keys
- `pricingPage` — all sub-keys

### testimonialsList — translate ALL fields including text

Every locale translates the `text` field. Only `author`, `role`, and `social` stay unchanged (they are real usernames/handles):

```json
{
  "text": "Translated review text here.",
  "author": "obimage",
  "role": "",
  "social": ""
}
```

---

## Checklist: Adding a New Language (`{lang}`)

### Create (3 files)

- [ ] `src/content/translations/{lang}.json` — full translation of all keys from `en.json`; translate `testimonialsList[].text` too
- [ ] `src/pages/{lang}/index.astro` — copy from another locale's index, update `lang="{lang}"`, import from `../../content/translations/{lang}.json`, add `{lang: '{lang}', href: 'https://subo.ai/{lang}/'}` to alternates
- [ ] `src/pages/{lang}/pricing.astro` — same pattern; use `../../consts` (not `../consts`)

### Update (9 files)

- [ ] `astro.config.mjs` — add `"{lang}"` to `locales` array
- [ ] `src/components/BaseHead.astro` — add `'{lang}'` to all `['fr','es','de']` arrays → x4 occurrences in the `<script>` block
- [ ] `src/components/LanguageSwitcher.astro` — add `{ code: "{lang}", label: "..." }` to `availableLangs`; add `'{lang}'` to the path-stripping `includes()` check
- [ ] `src/pages/index.astro` — add `{lang}` hreflang alternate
- [ ] `src/pages/fr/index.astro` — add `{lang}` hreflang alternate
- [ ] `src/pages/es/index.astro` — add `{lang}` hreflang alternate
- [ ] `src/pages/de/index.astro` — add `{lang}` hreflang alternate
- [ ] `src/pages/pricing.astro` — add `{lang}` hreflang alternate
- [ ] `src/pages/fr/pricing.astro` — add `{lang}` hreflang alternate
- [ ] `src/pages/es/pricing.astro` — add `{lang}` hreflang alternate
- [ ] `src/pages/de/pricing.astro` — add `{lang}` hreflang alternate

---

## BaseHead.astro — Language Redirect Logic

`src/components/BaseHead.astro` contains a client-side script that auto-redirects users to their preferred language on `/` and `/pricing`.

**Important pitfall:** The redirect block that covers both `/` and `/pricing` must preserve the path suffix. Use `suffix` to avoid stripping `/pricing`:

```js
if (['/', '/pricing'].includes(path)) {
  var suffix = path === '/pricing' ? '/pricing' : '';
  if (preferredLang && ['fr','es','de'].includes(preferredLang)) {
    window.location.pathname = '/' + preferredLang + suffix;
    return;
  }
  if (!preferredLang) {
    var userLang = (navigator.language || navigator.userLanguage || 'en').slice(0,2);
    if (!['en','fr','es','de'].includes(userLang)) userLang = 'en';
    if (['fr','es','de'].includes(userLang)) {
      window.location.pathname = '/' + userLang + suffix;
    }
  }
}
```

Without the `suffix`, clicking "Pricing" on a localized page would redirect to the homepage instead.

---

## Known Bugs Fixed

- `src/pages/fr/pricing.astro` had `from '../consts'` (wrong) — corrected to `from '../../consts'`. Same bug existed in `es/pricing.astro`. Check any new locale pricing pages use `../../consts`.
