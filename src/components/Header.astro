---
import HeaderLink from './HeaderLink.astro';
import { SITE_TITLE } from '../consts';

const navItems = [
  { text: 'Features', href: '/' },
  { text: 'Pricing', href: '/pricing' },
];

const resources = [
  { text: 'Tutorials', href: 'https://www.subo.ai/tutorial' },
  { text: 'Support Server', href: '/support' },
  { text: 'Billing Portal', href: '/billing-portal' },
  { text: 'Blog', href: '/blog' },
];
---
<nav class="nav nav--visible">
  <div class="nav__container">
    <div class="nav__brand">
      <a href="/" class="nav__logo" aria-label={SITE_TITLE}>
        <img src="/images/subo-combo-cap-white.png" alt={SITE_TITLE} class="nav__logo-img" />
      </a>
    </div>
    <div class="nav__content mono">
      <ul class="nav__list nav__list--desktop">
        <li class="nav__item">
          <HeaderLink href={navItems[0].href}>{navItems[0].text}</HeaderLink>
        </li>
        <li class="nav__item nav__item--dropdown">
          <button class="nav__dropdown-toggle" aria-haspopup="true" aria-expanded="false">Resources</button>
          <ul class="nav__dropdown-menu">
            {resources.map(resource => (
              <li class="nav__dropdown-item">
                <HeaderLink href={resource.href}>{resource.text}</HeaderLink>
              </li>
            ))}
          </ul>
        </li>
        <li class="nav__item">
          <HeaderLink href={navItems[1].href}>{navItems[1].text}</HeaderLink>
        </li>
        <li class="nav__item">
          <div class="nav__cta">
            <!-- <a href="/subscriptions" class="button button--white-outline">Upgrade</a> -->
                    <a href="/invite" class="button button--primary-bg hero__cta-link" target="_blank" rel="noopener noreferrer" style="display: inline-flex; align-items: center; gap: 0.5em;">
          <span style="display: flex; align-items: center;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
            </svg>
          </span>
          Add to Discord
        </a>
          </div>
        </li>
      </ul>
      <!-- Move the toggle button here, outside the ul -->
      <button class="nav__toggle" type="button" aria-label="Toggle menu">
        <span class="nav__toggle-line"></span>
        <span class="nav__toggle-line"></span>
        <span class="nav__toggle-line"></span>
      </button>
    </div>
  </div>
  <div class="nav__mobile">
    <ul class="nav__list nav__list--mobile">
      <li class="nav__item nav__item--expandable">
        <button class="nav__expand-toggle" aria-expanded="false" aria-controls="mobile-features-menu">
          Resources
          <span class="nav__caret">&#9660;</span>
        </button>
        <ul class="nav__expand-menu" id="mobile-resources-menu">
          {resources.map(resource => (
            <li class="nav__dropdown-item">
              <HeaderLink href={resource.href}>{resource.text}</HeaderLink>
            </li>
          ))}
        </ul>
      </li>
      <li class="nav__item">
        <HeaderLink href={navItems[1].href}>{navItems[1].text}</HeaderLink>
      </li>
      <li class="nav__item">
        <div class="nav__cta nav__cta--mobile">
          <a href="/subscriptions" class="button button--white-outline">Upgrade</a>
          <a href="/invite" class="button button--primary-bg hero__cta-link" target="_blank" rel="noopener noreferrer" style="display: inline-flex; align-items: center; gap: 0.5em;">
          <span style="display: flex; align-items: center;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
              </svg>
            </span>
          Add to Discord
          </a>
        </div>
      </li>
    </ul>
  </div>
</nav>

<style>
  .nav {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.95);
    backdrop-filter: blur(10px);
    z-index: 1000;
    padding: 1rem;
	  border-bottom: 1px solid var(--secondary-dark);
    transition: transform 0.3s ease;
  }

  .nav--hidden {
  transform: translateY(-100%);
  }

  .nav--visible {
  transform: translateY(0);
}

  .nav__container {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .nav__logo-img {
    height: 48px;
    width: auto;
      transition: opacity 0.2s ease;
    }
    .nav__logo:hover .nav__logo-img {
      opacity: 0.7;
    }
  }

  .nav__content {
    display: flex;
    align-items: center;
    gap: 2rem;
  }

  .nav__list {
    display: flex;
    align-items: center;
    gap: 1rem;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .nav__list--mobile {
    display: none;
    flex-direction: column;
    gap: 1rem;
    padding: 2rem 0;
  }

  .nav__cta {
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }

    .nav__item--dropdown {
      position: relative;
    }
    .nav__dropdown-toggle {
      background: none;
      border: none;
      color: inherit;
      font: inherit;
      cursor: pointer;
      padding: 0.5rem 1rem;
    }
    .nav__dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      background: rgba(0,0,0,0.98);
      border: 1px solid var(--secondary-dark);
      border-radius: 4px;
      min-width: 180px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      z-index: 1100;
      padding: 0.5rem 0;
    }
    .nav__item--dropdown:hover .nav__dropdown-menu,
    .nav__item--dropdown:focus-within .nav__dropdown-menu {
      display: block;
    }
    .nav__dropdown-item {
      padding: 0;
    }
    .nav__dropdown-item a {
      display: block;
      padding: 0.5rem 1rem;
      color: inherit;
      text-decoration: none;
      white-space: nowrap;
    }
    .nav__dropdown-item a:hover {
      background: var(--secondary-dark);
      color: var(--accent);
    }

  .nav__item--expandable {
  position: relative;
}
.nav__expand-toggle {
  background: none;
  border: none;
  color: inherit;
  font: inherit;
  cursor: pointer;
  width: 100%;
  text-align: left;
  padding: 0.5rem 1rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.nav__caret {
  margin-left: 0.5rem;
  font-size: 1rem;
  transition: transform 0.2s;
}
.nav__expand-toggle[aria-expanded="true"] .nav__caret {
  transform: rotate(180deg);
}
.nav__expand-menu {
  display: none;
  flex-direction: column;
  background: rgba(0,0,0,0.98);
  border-radius: 4px;
  margin-top: 0.5rem;
  padding: 0.5rem 0;
}
.nav__item--expandable.expanded .nav__expand-menu {
  display: flex;
}

  .nav__cta--mobile {
    flex-direction: column;
    gap: 1rem;
  }

  .nav__toggle {
    display: none;
    flex-direction: column;
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 0.5rem;
    gap: 4px;
  }

  .nav__toggle-line {
    width: 25px;
    height: 2px;
    background: white;
    transition: all 0.3s ease;
  }

  .nav__mobile {
    display: none;
    background: rgba(0, 0, 0, 0.98);
    padding: 0 20px;
  }

  .nav__mobile.active {
    display: block;
  }

/*  .button--primary-bg {
    background: var(--primary);
    color: #fff;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    font-size: 0.9rem;
    cursor: pointer;
    text-decoration: none;
  }*/

  .button--accent-bg {
    background: var(--accent);
    color: #fff;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    font-size: 0.9rem;
    cursor: pointer;
    text-decoration: none;
  }

  /* Mobile styles */
  @media (max-width: 768px) {
    .nav__list--desktop {
      display: none;
    }

    .nav__toggle {
      display: flex;
    }

    .nav__mobile.active .nav__list--mobile {
      display: flex;
    }
    .nav__logo-img {
    height: 32px;

  }
</style>

<script>
  // Mobile menu toggle
  const toggle = document.querySelector('.nav__toggle');
  const mobileMenu = document.querySelector('.nav__mobile');
  
  toggle?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('active');
    toggle.classList.toggle('active');
  });
  
  // Close mobile menu when clicking outside
  document.addEventListener('click', (e) => {
    if (!e.target.closest('.nav') && mobileMenu?.classList.contains('active')) {
      mobileMenu.classList.remove('active');
      toggle?.classList.remove('active');
    }
  });
  
  // Mobile expandable menu for Features
  document.addEventListener('DOMContentLoaded', () => {
  const expandToggle = document.querySelector('.nav__expand-toggle');
  const expandableItem = document.querySelector('.nav__item--expandable');
  expandToggle?.addEventListener('click', () => {
    const expanded = expandableItem.classList.toggle('expanded');
    expandToggle.setAttribute('aria-expanded', expanded ? 'true' : 'false');
  });
});

  let lastScrollY = window.scrollY;
  const nav = document.querySelector('.nav');

  window.addEventListener('scroll', () => {
    if (!nav) return;
    if (window.scrollY > lastScrollY && window.scrollY > 50) {
      // Scrolling down
      nav.classList.remove('nav--visible');
      nav.classList.add('nav--hidden');
    } else {
      // Scrolling up
      nav.classList.remove('nav--hidden');
      nav.classList.add('nav--visible');
    }
    lastScrollY = window.scrollY;
  });

</script>
